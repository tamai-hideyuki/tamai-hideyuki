# 条件分岐・パイプ・リダイレクト

- **シェルスクリプト内で処理を分岐させる基本構文。**
```bash
if [ 条件 ]; then
  コマンドA
else
  コマンドB
fi 
```
```text
- [ と ] は test コマンドのシンタックスシュガー
- 数値比較： -eq, -ne, -lt, -le, -gt, -ge
- 文字列比較： =, !=, -z（空文字列チェック）, -n（非空チェック）
```
**例**
```bash
if [ "$USER" = "root" ]; then
  echo "管理者ユーザーです"
else
  echo "一般ユーザーです"
fi
```
---


- **論理演算子 &&, ||**
  - コマンドA && コマンドB：Aが成功した場合のみBを実行
  - コマンドA || コマンドB：Aが失敗した場合のみBを実行

```bash
mkdir backup && echo "ディレクトリ作成成功" || echo "作成失敗"
```

---

- **ブランチ条件（case 文）**

- 複数パターンの分岐に向いた構文。
```bash
case "$変数" in
  パターン1)
    コマンド1 ;;
  パターン2|パターン3)
    コマンド2 ;;
  *)
    デフォルト処理 ;;
esac 
```

- **例**
```bash
case "$1" in
  start)
    echo "サービスを起動します" ;;
  stop)
    echo "サービスを停止します" ;;
  restart)
    echo "再起動します" ;;
  *)
    echo "使い方: $0 {start|stop|restart}" ;;
esac
```

---

- **パイプ**

- 複数コマンドの標準出力をつなげる。
```bash
コマンドA | コマンドB | コマンドC 
```

- 左側の標準出力（stdout）を右側の標準入力（stdin）へ渡す
- 複数段階のデータ処理に有効

- **例**
```bash
ps aux | grep nginx | awk '{print $2}' 
```

---

- **リダイレクト**

- ファイルへの入出力を操作。

| シンタックス       | 説明                       |
| ------------ | ------------------------ |
| `>`          | 標準出力をファイルへ上書き            |
| `>>`         | 標準出力をファイルへ追記             |
| `<`          | ファイルを標準入力として読み込む         |
| `2>`         | 標準エラー（`stderr`）をファイルへ上書き |
| `2>>`        | 標準エラーをファイルへ追記            |
| `&>` or `>&` | 標準出力と標準エラーをまとめてリダイレクト    |

- **例**
```bash
# 標準出力を out.log, 標準エラーを err.log に分離
some_command > out.log 2> err.log

# 標準出力・標準エラーをまとめて一つのファイルに
some_command &> all.log
```

---

- **標準出力・標準エラーの分離／同時出力**

- 個別に分離してログ取得したい場合は > out 2> err
- 両方を同時に表示しつつファイルにも残したい場合は tee と組み合わせ

```bash
# 両方をリアルタイム表示しつつ out.log にも保存
some_command 2>&1 | tee out.log
```

- 2>&1 で stderr を stdout に結合してからパイプ
- tee が受け取った内容を標準出力に流しつつファイルへ書き込む
